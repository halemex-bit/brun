<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="description" content="Join the Malaysia biggest Raya festival happening in Brunei. Secure your premium booth at BRIDEX today.">
    <meta property="og:title" content="Brunei 2026 ABGR Booking">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#FFFBEB">

    <title>Brunei 2026 ABGR Booking</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/bEd62zX.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        :root {
            /* THEME VARIABLES */
            --bg-color: #FFFBEB; 
            --text-main: #422006;
            --text-primary: #b45309; 
            --text-accent: #f59e0b; 
            --shadow-light: #ffffff;
            --shadow-dark: #e7e5e4; 

            /* LEGEND PRICES */
            --col-corner: #FFD166;
            --col-intermediate: #808080;
            --col-fnb-corner: #90EE90;
            --col-fnb-intermediate: #D3D3D3;
            --col-sold: #FFB6C1;
            --col-sold-stroke: #FF6600;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color); 
            color: var(--text-main);
            overflow-x: hidden;
            overscroll-behavior-y: none;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='%23b45309' stroke='white' stroke-width='2'%3E%3Cpath d='M2 2l7.5 19.5 3.5-8.5 8.5-3.5z'/%3E%3C/svg%3E"), auto !important;
        }

        /* NEUMORPHISM STYLE */
        .neu-panel { 
            background: var(--bg-color);
            border-radius: 20px;
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light); 
            border: 1px solid rgba(255,255,255,0.6);
        }
        .neu-pressed { 
            background: var(--bg-color);
            box-shadow: inset 6px 6px 10px var(--shadow-dark), inset -6px -6px 10px var(--shadow-light); 
            border-radius: 15px;
        }
        .neu-btn { 
            background: var(--bg-color);
            border: none; border-radius: 12px; color: var(--text-primary);
            box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); 
            transition: all 0.2s ease;
        }
        .neu-btn:hover { transform: translateY(-2px); }
        .neu-btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); transform: translateY(0); }
        
        .neu-btn-primary { 
            background: linear-gradient(135deg, #d97706, #b45309);
            color: white; border-radius: 12px; border: none; 
            box-shadow: 6px 6px 12px #d6d3d1, -6px -6px 12px #ffffff; transition: all 0.2s ease;
        }
        .neu-btn-primary:hover { transform: translateY(-2px); background: linear-gradient(135deg, #b45309, #92400e); }
        
        .neu-circle { 
            width: 40px;
            height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; background: var(--bg-color); color: var(--text-primary);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
        }
        .neu-input { 
            background: var(--bg-color);
            border: none; border-radius: 8px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); 
            padding: 12px; outline: none;
            width: 100%;
        }
        .neu-modal-overlay { background: rgba(255, 251, 235, 0.7); backdrop-filter: blur(8px); }
        
        .logo-container { 
            background: linear-gradient(145deg, #f59e0b, #d97706);
            border-radius: 50%; padding: 8px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light); 
            display: flex; align-items: center; justify-content: center;
        }

        /* SINGAPORE STYLE TABS */
        .tab-container {
            background: #e7e5e4;
            border-radius: 50px;
            padding: 4px;
            display: inline-flex;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1), inset -2px -2px 5px rgba(255,255,255,0.7);
            position: relative;
        }
        .tab-btn {
            padding: 10px 24px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 13px;
            color: #78716c;
            position: relative;
            z-index: 10;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        .tab-btn.active {
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .tab-indicator {
            position: absolute;
            height: calc(100% - 8px);
            top: 4px;
            border-radius: 40px;
            background: linear-gradient(135deg, #d97706, #b45309);
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }

        /* MARQUEE */
        .marquee-wrapper { overflow: hidden; white-space: nowrap; mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); }
        .marquee-track { display: flex; width: max-content; gap: 3rem; animation: scroll 15s linear infinite; }
        .marquee-track:hover { animation-play-state: paused; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* PARTNER LOGO */
        .partner-logo { 
            height: 60px; width: 120px; 
            background: #B1D6A0; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); 
            opacity: 1; flex-shrink: 0; overflow: hidden; padding: 0;
        }
        .partner-logo img { width: 100%; height: 100%; object-fit: contain; }

        /* ANNOUNCER TEXT */
        .announcer-container {
            background: linear-gradient(to right, #b45309, #d97706);
            color: white; padding: 6px 0; overflow: hidden; 
            border-top: 1px solid #fcd34d; border-bottom: 1px solid #fcd34d;
            display: flex;
        }
        .announcer-track {
            display: flex; gap: 4rem; 
            animation: announcerScroll 25s linear infinite;
            white-space: nowrap; font-size: 11px; font-weight: 600; letter-spacing: 1px; padding-left: 0;
        }
        @keyframes announcerScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* BOOTH STYLES */
        .booth { cursor: pointer; stroke: #000; stroke-width: 1px; fill: #FFFFFF; transition: all 0.2s; }
        .booth:hover { stroke: #d97706 !important; stroke-width: 4px !important; z-index: 100; }
        
        .booth.price-5950, .booth.price-5950 rect { fill: var(--col-corner) !important; } 
        .booth.price-5100, .booth.price-5100 rect { fill: var(--col-intermediate) !important; } 
        .booth.price-3400, .booth.price-3400 rect { fill: var(--col-fnb-corner) !important; } 
        .booth.price-2890, .booth.price-2890 rect { fill: var(--col-fnb-intermediate) !important; } 

        .booth.sold, .booth.reserved, .booth.prebooked {
            fill: var(--col-sold) !important;
            stroke: var(--col-sold-stroke) !important; stroke-width: 3 !important; stroke-dasharray: 8,4 !important; pointer-events: all !important; opacity: 1 !important;
        }
        .booth.selected { 
            fill: #007BFF !important; stroke: white !important; stroke-width: 3px !important;
            filter: drop-shadow(0 0 8px rgba(0, 123, 255, 0.6)); animation: selectedGlow 2s ease-in-out infinite;
        }
        .booth.searched { 
            fill: #007BFF !important; stroke: white !important; stroke-width: 3px !important; 
            animation: attentionSeeker 0.8s ease-in-out infinite !important; z-index: 50 !important;
        }

        @keyframes attentionSeeker { 0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px #007BFF); } 50% { transform: scale(1.2); filter: drop-shadow(0 0 20px #007BFF); } }
        @keyframes selectedGlow { 0% { filter: drop-shadow(0 0 5px #007BFF); } 50% { filter: drop-shadow(0 0 15px #007BFF); } 100% { filter: drop-shadow(0 0 5px #007BFF); } }

        /* TOOLTIP & NOTIFICATION */
        .tooltip { 
            position: fixed; z-index: 100; background: rgba(26, 26, 26, 0.95);
            color: white; padding: 12px; border-radius: 12px; font-size: 12px; pointer-events: none;
            border: 1px solid #f59e0b; transform: translate(-50%, -110%); box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        .notification-toast { 
            position: fixed; top: 90px; right: 20px; z-index: 200; background: #FFFBEB; 
            border-radius: 16px; padding: 16px 24px;
            box-shadow: 8px 8px 16px #e7e5e4, -8px -8px 16px #ffffff; 
            border: 1px solid rgba(255,255,255,0.5); display: flex; align-items: center; gap: 15px;
            transform: translateX(150%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-width: 350px;
        }
        .notification-toast.show { transform: translateX(0); }
        .neu-icon-btn { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; background: var(--bg-color); box-shadow: 5px 5px 10px #e7e5e4, -5px -5px 10px #ffffff; color: #b45309; text-decoration: none; transition: all 0.2s;
        }

        [x-cloak] { display: none !important; }
        .animate-fade-in-up { animation: modalSlideIn 0.3s ease-out; }
        @keyframes modalSlideIn { from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
    </style>
</head>

<body x-data="boothSystem()" x-init="initSystem()" class="min-h-screen flex flex-col">

    <div :class="notification.visible ? 'show' : ''" class="notification-toast">
        <div class="neu-circle w-10 h-10 flex-shrink-0 text-yellow-600"><i :class="notification.icon"></i></div>
        <div>
            <div class="font-bold text-yellow-800 text-sm uppercase tracking-wide" x-text="notification.title"></div>
            <div class="text-xs text-gray-600 font-medium" x-text="notification.message"></div>
        </div>
    </div>

    <div x-show="modals.welcome" x-cloak class="fixed inset-0 neu-modal-overlay z-[60] flex items-center justify-center p-4" style="display: flex !important;">
        <div class="neu-panel max-w-lg w-full p-8 relative animate-fade-in-up bg-white max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-6">
                <div class="inline-block p-4 rounded-2xl bg-gradient-to-br from-yellow-500 to-yellow-700 shadow-xl mb-4 transform hover:scale-105 transition">
                    <img src="https://i.imgur.com/uikzokX.png" alt="Absolut Bazaar" class="h-12 w-auto brightness-0 invert">
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Welcome to</h2>
                <p class="text-yellow-600 font-medium text-sm mt-1">Absolut Bazaar x Gaya Raya 2026</p>
                <p class="text-gray-600 text-sm mt-2">BRIDEX, BRUNEI â€¢ 27 FEB - 1 MAR 2026</p>
            </div>
            <div class="space-y-4 mb-8">
                <div class="flex items-center gap-4">
                    <div class="neu-circle w-10 h-10 flex-shrink-0 font-bold text-sm">1</div>
                    <div class="text-sm text-gray-700"><strong>Zoom & Pan</strong> to explore floor plan.</div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="neu-circle w-10 h-10 flex-shrink-0 font-bold text-sm">2</div>
                    <div class="text-sm text-gray-700">Click <strong>Available Booths</strong> to select (max 2).</div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="neu-circle w-10 h-10 flex-shrink-0 font-bold text-sm">3</div>
                    <div class="text-sm text-gray-700"><strong>50% Deposit</strong> is required to confirm your booking.</div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="neu-circle w-10 h-10 flex-shrink-0 font-bold text-sm">4</div>
                    <div class="text-sm text-gray-700 pt-2">For Non-Brunei Citizens: Professional visa required ($25 BND) and must be obtained before event.</div>
                </div>
            </div>
            <button @click="modals.welcome = false" class="w-full py-4 neu-btn-primary font-bold text-lg shadow-lg">I Understand</button>
        </div>
    </div>

    <header class="sticky top-0 z-40 py-3 bg-[#FFFBEB] shadow-sm">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center">
                <div class="logo-container mr-3">
                    <img src="https://i.imgur.com/uikzokX.png" alt="Logo" class="h-8 w-auto brightness-0 invert">
                </div>
                <div>
                    <h1 class="text-lg font-bold leading-tight text-yellow-800">Absolut Bazaar x Gaya Raya 2026</h1>
                    <p class="text-gray-500 text-xs font-semibold">
                        <a href="https://maps.app.goo.gl/BThqpLNV1SFvAeDa7" target="_blank" class="hover:text-yellow-600 hover:underline transition-colors flex items-center gap-1">
                            BRIDEX, BRUNEI â€¢ 27 FEB - 1 MAR 2026
                        </a>
                    </p>
                    <div class="flex items-center gap-3 mt-0.5">
                        <a href="https://drive.google.com/uc?export=download&id=1JYmCq3AOruaM4R4tUCrfvN2yFeOSLCVF" class="text-yellow-600 text-[10px] font-bold hover:underline hover:text-yellow-800 flex items-center gap-1">
                            <i class="fas fa-download"></i> Floor Plan
                        </a>
                        <button @click="modals.welcome = true" class="text-yellow-600 text-[10px] font-bold hover:underline hover:text-yellow-800 flex items-center gap-1 border-l border-yellow-400 pl-3">
                            <i class="fas fa-question-circle"></i> HELP
                        </button>
                    </div>
                </div>
            </div>
            <div x-show="selectedBooths.length > 0" x-transition class="neu-pressed px-4 py-2 rounded-full text-xs font-bold flex items-center text-yellow-700">
                <span x-text="selectedBooths.length + '/2 Selected'"></span>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-2 mt-2">

        <section class="mb-6">
            <h3 class="text-center text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Official Partners</h3>
            <div class="neu-pressed py-6 px-0 mx-2 overflow-hidden bg-white/30">
                <div class="marquee-wrapper">
                    <div class="marquee-track">
                        <div class="partner-logo"><img src="https://i.imgur.com/thhcuCt.jpeg" alt="Partner"></div>
                        <div class="partner-logo text-[10px] font-bold text-yellow-700 text-center leading-tight bg-[#FEF3C7]"><div class="p-2">COMING<br>SOON</div></div>
                        <div class="partner-logo text-[10px] font-bold text-yellow-700 text-center leading-tight bg-[#FEF3C7]"><div class="p-2">COMING<br>SOON</div></div>
                        <div class="partner-logo text-[10px] font-bold text-yellow-700 text-center leading-tight bg-[#FEF3C7]"><div class="p-2">COMING<br>SOON</div></div>
                        <div class="partner-logo"><img src="https://i.imgur.com/thhcuCt.jpeg" alt="Partner"></div>
                        <div class="partner-logo"><img src="https://i.imgur.com/thhcuCt.jpeg" alt="Partner"></div>
                        <div class="partner-logo text-[10px] font-bold text-yellow-700 text-center leading-tight bg-[#FEF3C7]"><div class="p-2">COMING<br>SOON</div></div>
                        <div class="partner-logo text-[10px] font-bold text-yellow-700 text-center leading-tight bg-[#FEF3C7]"><div class="p-2">COMING<br>SOON</div></div>
                        <div class="partner-logo text-[10px] font-bold text-yellow-700 text-center leading-tight bg-[#FEF3C7]"><div class="p-2">COMING<br>SOON</div></div>
                        <div class="partner-logo"><img src="https://i.imgur.com/thhcuCt.jpeg" alt="Partner"></div>
                    </div>
                </div>
            </div>
        </section>

        <div class="mb-4 flex flex-col items-center">
            <button @click="showLegend = !showLegend" class="text-xs font-bold text-yellow-700 hover:text-yellow-900 flex items-center gap-2 transition-colors bg-yellow-100 px-4 py-2 rounded-full shadow-sm">
                <span x-text="showLegend ? 'Hide Legend' : 'Show Legend'"></span>
                <i class="fas fa-chevron-down transition-transform duration-300" :class="showLegend ? 'rotate-180' : ''"></i>
            </button>
            <div x-show="showLegend" x-transition class="mt-4 flex justify-center gap-4 text-xs flex-wrap bg-yellow-50/50 p-4 rounded-xl border border-yellow-100 w-full">
                <div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--col-sold); border: 2px dashed var(--col-sold-stroke);"></span> Sold/Reserved</div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: #007BFF;"></span> Selected</div>
                
                <template x-if="activeTab === 'indoor'">
                    <div class="flex gap-4 flex-wrap justify-center">
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--col-corner);"></span> Corner RM 5,950</div>
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--col-intermediate);"></span> Intermediate RM 5,100</div>
                    </div>
                </template>
                <template x-if="activeTab === 'outdoor'">
                    <div class="flex gap-4 flex-wrap justify-center">
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--col-fnb-corner);"></span> F&B Corner RM 3,400</div>
                        <div class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--col-fnb-intermediate);"></span> F&B Intermediate RM 2,890</div>
                    </div>
                </template>
            </div>
        </div>

        <div class="flex justify-center mb-6 mt-4">
            <div class="tab-container">
                <div class="tab-indicator" 
                     :style="activeTab === 'indoor' ? 'left: 4px; width: 145px;' : 'left: 154px; width: 125px;'">
                </div>

                <button @click="switchTab('indoor')" 
                    :class="activeTab === 'indoor' ? 'active' : ''"
                    class="tab-btn">
                    INDOOR (Hall 1)
                </button>
                
                <button @click="switchTab('outdoor')" 
                    :class="activeTab === 'outdoor' ? 'active' : ''"
                    class="tab-btn">
                    OUTDOOR
                    <i x-show="loadingOutdoor" class="fas fa-circle-notch fa-spin text-[10px] ml-1"></i>
                </button>
            </div>
        </div>

        <div class="neu-panel p-2 relative h-[50vh] md:h-[600px] overflow-hidden mb-0 bg-white touch-none">
            <div x-show="loading" class="absolute top-2 right-2 z-30 bg-white/80 px-3 py-1 rounded-full text-xs font-bold text-yellow-600 shadow flex items-center gap-2">
                <i class="fas fa-circle-notch fa-spin"></i> Syncing...
            </div>
            
            <div class="absolute top-4 left-4 z-20 pointer-events-none">
                <span class="neu-pressed px-3 py-1 text-xs font-bold text-yellow-600 uppercase tracking-wider">
                    Floor Plan (<span x-text="activeTab.toUpperCase()"></span>)
                </span>
            </div>
            
            <div class="absolute top-4 right-4 z-20 flex flex-col gap-3">
                <button @click="zoomIn()" class="neu-circle"><i class="fas fa-plus"></i></button>
                <button @click="zoomOut()" class="neu-circle"><i class="fas fa-minus"></i></button>
                <button @click="resetZoom()" class="neu-circle"><i class="fas fa-compress"></i></button>
            </div>

            <div x-ref="floorplanContainer" @touchstart="handleTouchStart" @touchmove="handleTouchMove" @touchend="handleTouchEnd" @mousedown="startDrag" class="w-full h-full origin-top-left cursor-move" style="transform-origin: 0 0;">
                
                <div x-show="activeTab === 'indoor'" class="w-full h-full">
                    <svg id="booths-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 891.52 704.41" width="100%" height="100%">
                        <style>
                            text{font-family:sans-serif;font-size:6px;fill:#000}
                            .booth text{pointer-events:none}
                            .booth { fill: #E0E0E0; stroke: #000; stroke-width: 0.72px; cursor: pointer; }
                        </style>
                        <image href="https://i.imgur.com/f6UFCfe.jpeg" x="0" y="0" width="891.52" height="704.41" preserveAspectRatio="xMidYMid meet" />
                        
                        <path id="booth1" class="booth" data-booth-number="1" d="M214.6 240.33h13.98v14.04H214.6z" transform="rotate(11.83 221.514 247.283)"/>
                        <text class="booth-number" style="font-size:6px" transform="rotate(11.83 -1090.365 1185.312) scale(.93 1)"><tspan x="0" y="0">1</tspan></text>

                        <path id="booth2" class="booth" data-booth-number="2" d="M228.36 243.28h13.98v14.04h-13.98z" transform="rotate(11.83 235.279 250.198)"/>
                        <text class="booth-number" style="font-size:6px" transform="rotate(11.83 -1097.722 1253.194) scale(.93 1)"><tspan x="0" y="0">2</tspan></text>

                        <path id="booth110" class="booth" data-booth-number="110" d="M558.7 267.48h13.98v14.04H558.7z" transform="rotate(30.53 565.768 274.56)"/>
                        <text class="booth-number" style="font-size:6px" transform="matrix(.80107 .47243 -.50799 .86136 561.05 273.82)"><tspan x="0" y="0">110</tspan></text>

                        <path id="booth111" class="booth" data-booth-number="111" d="M539.42 272.29h13.98v14.04h-13.98z" transform="rotate(30.53 546.471 279.374)"/>
                        <text class="booth-number" style="font-size:6px" transform="matrix(.80107 .47243 -.50799 .86136 541.77 278.63)"><tspan x="0" y="0">111</tspan></text>
                    </svg>
                </div>

                <div x-show="activeTab === 'outdoor'" class="w-full h-full flex items-center justify-center">
                    <template x-if="!outdoorSVG && loadingOutdoor">
                         <div class="text-yellow-600 font-bold animate-pulse">Loading Outdoor Plan...</div>
                    </template>
                    <template x-if="!outdoorSVG && !loadingOutdoor">
                         <div class="text-gray-400 text-sm">No floor plan loaded.</div>
                    </template>
                    <div x-html="outdoorSVG" class="w-full h-full"></div>
                </div>
            </div>

            <div x-show="tooltip.visible" x-bind:style="`top: ${tooltip.y}px; left: ${tooltip.x}px`" class="tooltip">
                <div x-html="tooltip.content"></div>
            </div>
        </div>

        <div class="announcer-container w-full mb-0 rounded-b-xl -mt-1">
            <div class="announcer-track">
                <span>ðŸ“¢ LIMITED BOOTHS! BOOK YOUR SLOT FOR ABSOLUT BAZAAR x GAYA RAYA 2026 @ BRIDEX BRUNEI NOW! ðŸ“¢ FIRST COME FIRST SERVE.</span>
                <span>ðŸ“¢ LIMITED BOOTHS! BOOK YOUR SLOT FOR ABSOLUT BAZAAR x GAYA RAYA 2026 @ BRIDEX BRUNEI NOW! ðŸ“¢ FIRST COME FIRST SERVE.</span>
            </div>
        </div>

        <div class="py-2 px-4 bg-yellow-50/50 border-b border-yellow-100 mb-4">
            <div class="max-w-xs mx-auto flex gap-2">
                <input type="text" x-model="searchQuery" @keyup.enter="searchBooth" placeholder="SEARCH (E.G. 10 or C1)" class="neu-input py-1 text-xs uppercase font-bold text-center tracking-widest flex-1">
                <button @click="searchBooth" class="neu-btn w-8 h-8 flex-shrink-0 flex items-center justify-center text-yellow-600 bg-white shadow-sm hover:text-yellow-800">
                    <i class="fas fa-search text-xs"></i>
                </button>
            </div>
        </div>

        <div x-show="selectedBooths.length > 0" x-transition class="fixed bottom-0 left-0 right-0 z-50 p-4">
            <div class="max-w-7xl mx-auto neu-panel p-4 flex flex-col sm:flex-row justify-between items-center gap-4 bg-opacity-95 backdrop-blur-md">
                <div class="flex-1 w-full">
                    <div class="flex flex-wrap gap-2">
                        <template x-for="booth in selectedBooths" :key="booth">
                            <div class="neu-pressed px-3 py-1 rounded-lg flex items-center gap-3">
                                <span class="font-bold text-yellow-800 text-sm" x-text="booth"></span>
                                <span class="text-[10px] text-gray-600" x-text="'BND ' + getPrice(booth).toLocaleString()"></span>
                                <button @click="toggleSelection(booth)" class="text-red-400 hover:text-red-600"><i class="fas fa-times"></i></button>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="flex items-center gap-6 w-full sm:w-auto justify-between sm:justify-end">
                    <div class="text-right">
                        <div class="text-xs text-gray-500">Total Amount</div>
                        <div class="text-xl font-bold text-yellow-600" x-text="'BND ' + totalPrice.toLocaleString()"></div>
                        <div class="text-xs text-gray-600">Deposit (50%): BND <span x-text="(totalPrice/2).toLocaleString()"></span></div>
                    </div>
                    <button @click="modals.booking = true" class="px-8 py-3 neu-btn-primary font-bold shadow-lg">Proceed <i class="fas fa-arrow-right ml-2"></i></button>
                </div>
            </div>
        </div>
    </main>

    <footer class="neu-panel mt-4 p-6 rounded-none rounded-t-2xl mx-2 mb-0" style="background: var(--bg-color);">
        <div class="max-w-7xl mx-auto flex flex-row justify-between items-center relative z-10">
            <div class="social-media-icons flex flex-row gap-4">
                <a href="https://www.facebook.com/absolutbazaar" target="_blank" class="neu-icon-btn"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/absolutbazaar" target="_blank" class="neu-icon-btn"><i class="fab fa-instagram"></i></a>
                <a href="https://www.tiktok.com/@absolutevent" target="_blank" class="neu-icon-btn"><i class="fab fa-tiktok"></i></a>
            </div>
            <div class="flex items-center">
                <div class="text-right mr-3">
                    <h3 class="font-bold text-sm text-gray-700">Absolut Bazaar</h3>
                    <p class="text-yellow-600 text-[10px]">Contact: info@absolutevent.my</p>
                </div>
                <div class="logo-container">
                    <img src="https://i.imgur.com/uikzokX.png" alt="Logo" class="h-6 w-6 brightness-0 invert">
                </div>
            </div>
        </div>
    </footer>

    <div x-show="modals.booking" class="fixed inset-0 neu-modal-overlay z-50 flex items-center justify-center p-4" x-cloak>
        <div class="neu-panel max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 relative bg-white">
            <div class="flex justify-between items-center mb-6 border-b border-gray-200 pb-4">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-file-signature text-yellow-500 mr-3"></i> Booth Booking Form
                </h2>
                <button @click="modals.booking = false" class="text-gray-400 hover:text-yellow-600 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <form @submit.prevent="generateSummary" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" x-model="form.companyName" required placeholder="Company Name *" class="neu-input">
                    <input type="text" x-model="form.brandName" required placeholder="Brand Name *" class="neu-input">
                    <input type="text" x-model="form.personInCharge" required placeholder="PIC Name *" class="neu-input">
                    <input type="tel" x-model="form.phoneNumber" required placeholder="Phone *" class="neu-input">
                    <input type="email" x-model="form.email" required placeholder="Email *" class="neu-input w-full md:col-span-2">
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <input type="url" x-model="form.socialMedia" placeholder="Social Media Link" class="neu-input">
                    <textarea x-model="form.sellingItems" required rows="3" placeholder="Products/Services to Sell *" class="neu-input"></textarea>
                    <textarea x-model="form.billingAddress" required rows="3" placeholder="Billing Address *" class="neu-input"></textarea>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" x-model="form.termsAgreement" required>
                    <span class="text-sm text-gray-700">I understand that this is a booking request subject to approval.</span>
                </div>
                <div class="flex gap-4">
                    <button type="button" @click="modals.booking = false" class="flex-1 py-3 border rounded-lg">Cancel</button>
                    <button type="submit" class="flex-1 py-3 neu-btn-primary font-bold">Submit Booking Request</button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="modals.summary" class="fixed inset-0 neu-modal-overlay z-50 flex items-center justify-center p-4" x-cloak>
        <div class="neu-panel max-w-xl w-full max-h-[90vh] overflow-y-auto p-6 relative bg-white">
            <div class="text-center mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-bold text-gray-800">Booking Summary</h2></div>
            <div class="space-y-6">
                <div class="neu-pressed p-4 rounded-xl">
                    <div class="text-xs text-gray-500 uppercase font-bold mb-2">Customer Details</div>
                    <div class="font-bold" x-text="form.companyName"></div>
                    <div class="text-sm">PIC: <span x-text="form.personInCharge"></span> (<span x-text="form.phoneNumber"></span>)</div>
                </div>
                <div>
                    <h3 class="font-bold text-gray-700 mb-2">Selected Booths</h3>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <template x-for="booth in selectedBooths">
                            <span class="neu-pressed px-3 py-1 text-sm font-bold text-yellow-800" x-text="booth"></span>
                        </template>
                    </div>
                    
                    <div class="neu-pressed p-4 rounded-xl flex justify-between items-center mb-2">
                        <span class="text-gray-600 font-bold">Total Amount</span>
                        <div class="text-right">
                            <div class="font-bold text-lg text-yellow-600" x-text="'BND ' + totalPrice.toLocaleString()"></div>
                            <div class="text-xs text-gray-500" x-text="'| RM ' + (totalPrice * 3.4).toLocaleString(undefined, {minimumFractionDigits: 2})"></div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-4">
                    <button @click="handleBookingAction('absolut')" class="py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl shadow-lg flex justify-center items-center font-bold">
                        <i class="fab fa-whatsapp text-2xl mr-2"></i> Send to Absolut (MY)
                    </button>
                    <button @click="handleBookingAction('brunei')" class="py-4 bg-teal-600 hover:bg-teal-700 text-white rounded-xl shadow-lg flex justify-center items-center font-bold">
                        <i class="fab fa-whatsapp text-2xl mr-2"></i> Send to Partner (BN)
                    </button>
                </div>
                <button @click="handleBookingAction('copy')" class="w-full py-3 neu-btn text-sm font-bold text-gray-600 mt-2">Copy Booking Summary</button>
                <button @click="modals.summary = false; modals.booking = true" class="w-full py-2 text-xs text-gray-400 hover:text-gray-600">Back to Edit</button>
            </div>
        </div>
    </div>

    <div x-show="modals.success" class="fixed inset-0 neu-modal-overlay z-[70] flex items-center justify-center p-4" x-cloak>
        <div class="neu-panel max-w-md w-full p-8 relative animate-fade-in-up bg-white text-center">
            <div class="mb-4"><div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto text-green-500 text-3xl shadow-md"><i class="fas fa-check"></i></div></div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Booking Generated!</h3>
            <p class="text-sm text-gray-600 leading-relaxed mb-6">Kindly send booking summary to our sales representative via WhatsApp.</p>
            <button @click="modals.success = false" class="px-8 py-3 neu-btn-primary font-bold shadow-lg w-full">Okay, Got it!</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://amnkzofafegoglcbctan.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFtbmt6b2ZhZmVnb2dsY2JjdGFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4NDI1NTMsImV4cCI6MjA4MjQxODU1M30.lRlLKq_12QKJIM6LvZCIntktKbJ8-y8s8g9zl6TmhJM';

        document.addEventListener('alpine:init', () => {
            Alpine.data('boothSystem', () => ({
                loading: true, boothData: {}, selectedBooths: [], showLegend: false,
                modals: { welcome: true, booking: false, summary: false, success: false },
                tooltip: { visible: false, x: 0, y: 0, content: '' },
                notification: { visible: false, title: '', message: '', icon: '' },
                searchQuery: '',
                form: { companyName: '', brandName: '', personInCharge: '', phoneNumber: '', email: '', socialMedia: '', sellingItems: '', billingAddress: '', termsAgreement: false },
                
                // TAB & FETCHING VARS
                activeTab: 'indoor',
                outdoorSVG: '',
                loadingOutdoor: false,

                // ZOOM & PINCH VARS
                zoomLevel: 1, panX: 0, panY: 0, isDragging: false, startX: 0, startY: 0,
                initialPinchDist: 0, initialZoom: 1,

                supabase: null,

                async initSystem() { 
                    try { this.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY); } catch(e) {}
                    await this.fetchBooths();
                    setInterval(() => this.fetchBooths(), 1200000); 
                    this.updateTransform();
                    this.refreshVisuals();
                },

                // SWITCH TAB LOGIC
                async switchTab(tab) {
                    this.activeTab = tab;
                    this.resetZoom();

                    if (tab === 'outdoor' && !this.outdoorSVG) {
                        this.loadingOutdoor = true;
                        try {
                            const response = await fetch('outdoor.html');
                            if (response.ok) {
                                this.outdoorSVG = await response.text();
                                this.$nextTick(() => { this.refreshVisuals(); });
                            }
                        } catch (e) { console.error(e); } finally { this.loadingOutdoor = false; }
                    } else {
                        this.$nextTick(() => { this.refreshVisuals(); });
                    }
                },
                
                async fetchBooths() {
                    this.loading = true;
                    try {
                        const { data, error } = await this.supabase.from('bookings_brunei').select('*');
                        if (!error) {
                            this.boothData = {};
                            data.forEach(b => { this.boothData[b.booth_numbers] = b; });
                            this.refreshVisuals();
                        }
                    } catch(e){} finally { this.loading = false; }
                },

                refreshVisuals() {
                    const container = this.$refs.floorplanContainer;
                    if (!container) return;
                    
                    container.querySelectorAll('.booth').forEach(el => {
                        const bNum = el.getAttribute('data-booth-number');
                        if (!bNum) return;
                        
                        el.onmouseenter = (e) => this.showTooltip(e, bNum);
                        el.onmouseleave = () => this.tooltip.visible = false;
                        el.onclick = () => this.toggleSelection(bNum);
                        
                        el.classList.remove('sold', 'selected', 'price-5950', 'price-5100', 'price-3400', 'price-2890', 'searched');
                        
                        if (this.selectedBooths.includes(bNum)) { el.classList.add('selected'); return; }
                        
                        const info = this.boothData[bNum];
                        const status = info ? info.status : 'AVAILABLE';
                        if (status !== 'AVAILABLE') el.classList.add('sold');
                        else {
                            const p = this.getPrice(bNum);
                            // Highlight rules
                            if(p==1750||p==5950) el.classList.add('price-5950');
                            else if(p==1500||p==5100) el.classList.add('price-5100');
                            else if(p==1000||p==3400) el.classList.add('price-3400');
                            else if(p==850||p==2890) el.classList.add('price-2890');
                        }
                    });
                },

                toggleSelection(bNum) {
                    const info = this.boothData[bNum];
                    if (info && info.status !== 'AVAILABLE') return this.showNotif('Taken', 'Booth unavailable', 'fas fa-lock');
                    if (this.selectedBooths.includes(bNum)) this.selectedBooths = this.selectedBooths.filter(b => b !== bNum);
                    else {
                        if (this.selectedBooths.length >= 2) return this.showNotif('Limit', 'Max 2 booths', 'fas fa-exclamation');
                        this.selectedBooths.push(bNum);
                    }
                    this.refreshVisuals();
                },

                showTooltip(e, bNum) {
                    const info = this.boothData[bNum] || {};
                    const price = this.getPrice(bNum);
                    const category = info.category || 'Standard';
                    const status = info.status || 'AVAILABLE';
                    const isAvailable = status === 'AVAILABLE';
                    let priceHtml = isAvailable ? `<div class="text-xs text-gray-200">Price: BND ${price > 0 ? price.toLocaleString() : '-'}</div>` : '';

                    this.tooltip.content = `
                        <div class="font-bold text-yellow-300">Booth ${bNum}</div>
                        <div class="text-[10px] text-gray-300 mb-1 border-b border-gray-600 pb-1">${category}</div>
                        ${priceHtml}
                        <div class="text-[10px] font-bold mt-1 uppercase ${isAvailable?'text-green-400':'text-red-400'}">${status}</div>
                    `;
                    this.tooltip.x = e.clientX; this.tooltip.y = e.clientY - 10; this.tooltip.visible = true;
                },

                getPrice(bNum) {
                    const info = this.boothData[bNum];
                    if (info) {
                        if (info.price_bnd) return parseFloat(info.price_bnd);
                        if (info.g) return parseFloat(info.g);
                        if (info.h) return parseFloat(info.h);
                    }
                    return 0;
                },
                
                get totalPrice() { return this.selectedBooths.reduce((t, b) => t + this.getPrice(b), 0); },

                showNotif(title, msg, icon) {
                    this.notification = { visible: true, title, message: msg, icon };
                    setTimeout(() => this.notification.visible = false, 3000);
                },

                async searchBooth() {
                    let q = this.searchQuery.trim().toUpperCase();
                    if (!q) return;

                    // DETECT IF OUTDOOR (Starts with C or K)
                    const isOutdoor = /^[CK]/.test(q); 
                    
                    if (isOutdoor && this.activeTab !== 'outdoor') {
                        await this.switchTab('outdoor');
                    } else if (!isOutdoor && this.activeTab !== 'indoor') {
                        await this.switchTab('indoor');
                    }

                    this.$nextTick(() => {
                        let el = document.querySelector(`[data-booth-number="${q}"]`);
                        if (!el) el = document.getElementById(`booth${q}`);
                        if (!el && isOutdoor) el = document.getElementById(`booth${q}`); 
                        
                        if (el) { 
                            document.querySelectorAll('.searched').forEach(e => e.classList.remove('searched'));
                            el.classList.add('searched');
                            setTimeout(() => el.classList.remove('searched'), 3000); 
                            this.showNotif('Found', `Located Booth ${q}`, 'fas fa-map-pin');
                        }
                        else {
                            this.showNotif('Not Found', 'Booth not found', 'fas fa-search');
                        }
                    });
                },

                generateSummary() { this.modals.booking = false; this.modals.summary = true; },

                handleBookingAction(type) {
                    const refId = 'BRN' + Math.floor(100000 + Math.random() * 900000);
                    const payload = { 
                        booking_id: refId,
                        company_name: this.form.companyName,
                        brand_name: this.form.brandName,
                        person_in_charge: this.form.personInCharge,
                        phone_number: this.form.phoneNumber,
                        email: this.form.email,
                        social_media: this.form.socialMedia,
                        selling_items: this.form.sellingItems,
                        billing_address: this.form.billingAddress,
                        selected_booths: this.selectedBooths,
                        total_price: this.totalPrice,
                        status: 'pending'
                    };
                    this.supabase.from('profor').insert([payload]).then(({error}) => {
                        if(error) console.error(error); else console.log('Saved to PROFOR');
                    });
                    const rate = 3.4;
                    const totRM = (this.totalPrice * rate).toLocaleString(undefined, {minimumFractionDigits: 2});
                    const depBND = (this.totalPrice / 2).toLocaleString();
                    const depRM = ((this.totalPrice / 2) * rate).toLocaleString(undefined, {minimumFractionDigits: 2});
                    let msg = `*ABSOLUT BAZAAR x GAYA RAYA 2026*\nBRIDEX, BRUNEI â€¢ 27 FEB - 1 MAR 2026\n\n`;
                    msg += `ID: ${refId}\nCompany: ${this.form.companyName}\nBrand: ${this.form.brandName}\nPIC: ${this.form.personInCharge}\nPhone: ${this.form.phoneNumber}\n\n`;
                    msg += `Booths: ${this.selectedBooths.join(', ')}\n`;
                    msg += `Total: BND ${this.totalPrice.toLocaleString()} | RM ${totRM}\n`;
                    msg += `Deposit (50%): BND ${depBND} | RM ${depRM}\n(Non-Refundable Deposit)\n\n`;
                    msg += `Items: ${this.form.sellingItems}\n\nPlease confirm booking. Thank you!`;
                    if (type === 'absolut') window.open(`https://wa.me/60176831247?text=${encodeURIComponent(msg)}`, '_blank');
                    else if (type === 'brunei') window.open(`https://wa.me/6737131371?text=${encodeURIComponent(msg)}`, '_blank');
                    else if (type === 'copy') {
                        navigator.clipboard.writeText(msg);
                        this.showNotif('Copied', 'Summary copied', 'fas fa-copy');
                    }
                    
                    this.modals.summary = false; this.modals.success = true; this.selectedBooths = []; this.refreshVisuals();
                },

                // TOUCH & PINCH ZOOM
                getDistance(touches) { return Math.hypot(touches[0].clientX - touches[1].clientX, touches[0].clientY - touches[1].clientY); },
                
                handleTouchStart(e) {
                    if (e.touches.length === 2) {
                        this.isDragging = false;
                        this.initialPinchDist = this.getDistance(e.touches);
                        this.initialZoom = this.zoomLevel;
                    } else if (e.touches.length === 1) { this.startDrag(e); }
                },

                handleTouchMove(e) {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const dist = this.getDistance(e.touches);
                        const scale = dist / this.initialPinchDist;
                        this.zoomLevel = Math.min(Math.max(this.initialZoom * scale, 0.5), 4);
                        this.updateTransform();
                    } else if (e.touches.length === 1 && this.isDragging) {
                        e.preventDefault();
                        const x = e.touches[0].clientX; const y = e.touches[0].clientY;
                        this.panX = x - this.startX; this.panY = y - this.startY;
                        this.updateTransform();
                    }
                },

                handleTouchEnd(e) { this.isDragging = false; if (e.touches.length < 2) this.initialPinchDist = 0; },

                startDrag(e) {
                    if (e.target.closest('.booth')) return;
                    this.isDragging = true;
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    this.startX = clientX - this.panX; this.startY = clientY - this.panY;
                    if (!e.touches) {
                        const move = (ev) => { if(!this.isDragging)return; ev.preventDefault(); this.panX=ev.clientX-this.startX; this.panY=ev.clientY-this.startY; this.updateTransform(); };
                        const end = () => { this.isDragging=false; window.removeEventListener('mousemove',move); window.removeEventListener('mouseup',end); };
                        window.addEventListener('mousemove',move); window.addEventListener('mouseup',end);
                    }
                },

                zoomIn(){ this.zoomLevel=Math.min(this.zoomLevel*1.2, 4); this.updateTransform(); }, 
                zoomOut(){ this.zoomLevel=Math.max(this.zoomLevel/1.2, 0.5); this.updateTransform(); }, 
                resetZoom(){ this.zoomLevel=1; this.panX=0; this.panY=0; this.updateTransform(); },
                
                updateTransform(){ 
                    if(this.$refs.floorplanContainer) this.$refs.floorplanContainer.style.transform=`translate(${this.panX}px, ${this.panY}px) scale(${this.zoomLevel})`;
                }
            }));
        });
    </script>
</body>
</html>
